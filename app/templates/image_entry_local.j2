<div class="eintrag">
    <table style="width: 100%; table-layout: fixed">
        <tr>
            <td colspan="2" class="bildname">
                <span style="cursor:pointer; margin-left:10px;" onclick="saveAndGoName('{{ image_name }}')">
                    üîç
                </span>
                {{ image_name }}
                {% if civitai %}
                    <span style="cursor:pointer; margin-left:10px;" onclick="window.open('{{ civitai }}', '_blank')">
                        ü§ñ
                    </span>
                {% endif %}
            </td>
        </tr>
        <tr>
            <!-- Bild in der ersten Spalte -->
            <td style="width: 60%; vertical-align: top">
                {% if nsfw_scores %}
                    <div class="nsfw-bars">
                        {% for label, value in nsfw_scores.items() %}
                            <div class="nsfw_quality-bar" data-tooltip="{{ label }}: {{ value }}">
                                <div class="nsfw_bar" style="width: 100%">
                                    <div class="nsfw_marker" style="left: {{ value }}%">‚óè</div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}

                <img
                        alt="{{ image_name }}"
                        class="bild"
                        onclick="openModal('{{ folder_name }}/{{ image_name }}')"
                        src="{{ thumbnail_src }}"
                        style="cursor: pointer; max-width: 100%"
                />

                {% if quality_scores %}
                    <div class="nsfw-bars">
                        {% for label, value in quality_scores.items() %}
                            <div class="nsfw_quality-bar" data-tooltip="{{ label }}: {{ value }}">
                                <div class="nsfw_bar" style="width: 100%">
                                    <div class="nsfw_marker" style="left: {{ value }}%">‚óè</div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}

                <!-- Zus√§tzliche Thumbnails -->
                <div class="thumbnails-row">
                    {% for thumb in extra_thumbnails %}
                        <img
                                src="{{ thumb.src }}"
                                alt="extra"
                                class="thumbnail-mini"
                                onclick="openModalThumb('{{ thumb.image_name }}')"
                                style="cursor: pointer"/>
                    {% endfor %}
                </div>
            </td>
            <td style="width: 40%; vertical-align: top; padding-left: 10px">
                <div id="checkboxes-{{ image_id }}">
                    <form class="checkbox-container" style="line-height: 0.8;">
                        <input name="image_id" type="hidden" value="{{ image_id }}"/>
                        <table style="width:100%; border-collapse:collapse; font-size:12px;">
                          {% for k in kategorien %}
                            <tr>
                              <!-- Move-Icon Spalte -->
                              <td style="width:18px; text-align:left; padding:1px 3px;">
                                <span
                                  onclick="move('{{ k.key }}', '{{ image_name }}')"
                                  style="cursor:pointer; font-size:12px;"
                                  title="Move to {{ k.label }}"
                                >üì•</span>
                              </td>
                              <!-- Checkbox Spalte -->
                              <td style="width:18px; text-align:left; padding:1px 3px;">
                                <input
                                  name="{{ image_id }}_{{ k.key }}"
                                  type="checkbox"
                                  data-group="{{ image_id }}_group"
                                  onchange="handleCheckboxChange(this)"
                                  style="margin:0; transform: scale(0.85);"
                                  {{ 'checked' if status.get(k.key) else '' }}
                                />
                              </td>
                              <!-- Icon Spalte -->
                              <td style="width:18px; text-align:left; padding:1px 3px;">
                                {{ k.icon }}
                              </td>
                              <!-- Label Spalte -->
                              <td style="text-align:left; padding:1px 3px;">
                                {{ k.label }}
                              </td>
                            </tr>
                          {% endfor %}
                        </table>
                    </form>
                </div>
                <script>
                    function handleCheckboxChange(checkbox) {
                        const group = checkbox.dataset.group;
                        const checkboxes = document.querySelectorAll(`input[data-group="${group}"]`);

                        if (checkbox.checked) {
                            checkboxes.forEach(cb => {
                                if (cb !== checkbox) {
                                    cb.checked = false;
                                }
                            });
                        }

                        const formData = new FormData();
                        formData.append('image_id', checkbox.name.split('_')[0]);
                        checkboxes.forEach(cb => {
                            formData.append(cb.name, cb.checked);
                        });

                        fetch('/gallery/save', {
                            method: 'POST',
                            body: formData
                        });
                    }
                </script>
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <div class="text">{{ text_content | safe }}</div>
            </td>
        </tr>
    </table>
</div>